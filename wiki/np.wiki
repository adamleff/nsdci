#summary Networked Poll api
#labels Phase-Implementation

= Networked Poll (nps, nps2, npc, npc2) =
nsdci/dcicommon/poll.c

== Introduction ==
The Networked Poll api (npc, npc2, nps, nps2) is is used to maintain votes for specific positions in a bucket of 20 choices. Similar to Networked Tally api ([nt]), Networked Poll keeps a running total, but not for user-defined keys. And unlike Networked Tally, the bucket does not need to be "swept".  The api is only exposed when properly configured. See the "Configuration" section for more information.

== TCL API ==

===npc.vote===
Used to send a choice for a named poll to the poll server.  Returns a tcl list with the current standings. A choice > 20 or < 0 will return the current standing without adding a vote.  See the "Usage" section for examples.

*npc.vote* _poll choice_

|| *Argument* || *Description* ||
|| _poll_ || String. The name of the poll. Polls are self initializing. ||
|| _choice_ || Integer. The choice selected one through 20. ||

|| *Result* || *Description* ||
|| {{{TCL_LIST}}} || Success. The choice was tallied and the current standings retunred. ||
|| {{{TCL_ERROR}}} || Failure. An error occurred. See the server log for more information. ||

{{{
--------------------------------------------------------------------------------
}}}

===npc2.vote===
Used to adjust the poll standings. This is an admin utility and should not be used cast votes.  The choice is adjusted by the amount specified and the same number of "total poll votes" are taken away. See the "Usage" section for examples.

*npc2.vote* _poll choice adjust_

|| *Argument* || *Description* ||
|| _poll_ || String. The name of the poll. Polls are self initializing. ||
|| _choice_ || Integer. The choice selected one through 20. ||
|| _adjust_ || Integer. The amount + or - to adjust. ||


|| *Result* || *Description* ||
|| {{{TCL_LIST}}} || Success. The choice was adjusted, the total was adjusted, and the adjusted standings retunred. ||
|| {{{TCL_ERROR}}} || Failure. An error occurred. See the server log for more information. ||

{{{
--------------------------------------------------------------------------------
}}}

===npc.debug===
Used to retrieve the current debug value, or to set a new debug value.

*npc.debug* _?boolean?_

|| *Argument* || *Description* ||
|| _?boolean?_ || Boolean. Optional. Specifies whether or not debugging is enabled. ||


|| *Result* || *Description* ||
|| {{{1}}} || Success. Returned if a boolean was specified. ||
|| {{{BOOLEAN}}} || Success. If a boolean was not specified, then the current debug value is returned. ||

{{{
--------------------------------------------------------------------------------
}}}

== Configuration ==

====Server:====
{{{
    ns_section "ns/server/$server/modules"
        ns_param nssock nssock.so        
        ns_param dci dci.so

    ns_section "ns/server/$server/module/nssock"
        ns_param hostname $hostName
        ns_param address $address
        ns_param port $httpPort

    ns_section "ns/server/$server/module/dci/np"
        ns_param debug 1

    ns_section "ns/server/$server/module/dci/rpc/server/np"
        ns_param http 1

    ns_section "ns/server/$server/module/dci/np/server/clients"
        # This section has no params but is still required.
}}}
====Client====
{{{
    ns_section "ns/server/$server/module/dci/np"
        ns_param debug 1

    ns_section "ns/server/$server/module/dci/np/client"
        ns_param $server $server

    ns_section "ns/server/$server/module/dci/rpc/client/np"
        ns_param address $npServerAddress
        ns_param port $npServerHttpPort
        ns_param httpkeepalive true
        ns_param httpnumconnections 1

    ns_section "ns/server/$server/module/dci/rpc/client/np2"
        ns_param address $npServerAddress
        ns_param port $npServerHttpPort
        ns_param httpkeepalive true
        ns_param httpnumconnections 1
}}}

==Usage==

==Best Practices==
For security, you should not configure the np clients with the npc2 api. This will avoid giving adjustment access to voting clients.
